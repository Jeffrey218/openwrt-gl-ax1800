Skip to content


	•	  In this repository All GitHub ↵  Jump to ↵  
	•	No suggested jump to results 
	•	  In this repository All GitHub ↵  Jump to ↵  
	•	  In this user All GitHub ↵  Jump to ↵  
	•	  In this repository All GitHub ↵  Jump to ↵  
	•	
Dashboard Pull requests Issues Codespaces
Marketplace 
Explore Sponsors Settings ￼ Jeffrey218
Sign out 



New repository Import repository New codespace New gist New organization 
￼ 

Sorry, something went wrong. 




Jeffrey218  /   OpenWrt-CI  /  

Clear Command Palette 
Tip: Type # to search pull requests 
Type ? for help and tips 
Tip: Type # to search issues 
Type ? for help and tips 
Tip: Type # to search discussions 
Type ? for help and tips 
Tip: Type ! to search projects 
Type ? for help and tips 
Tip: Type @ to search teams 
Type ? for help and tips 
Tip: Type @ to search people and organizations 
Type ? for help and tips 
Tip: Type > to activate command mode 
Type ? for help and tips 
Tip: Go to your accessibility settings to change your keyboard shortcuts 
Type ? for help and tips 
Tip: Type author:@me to search your content 
Type ? for help and tips 
Tip: Type is:pr to filter to pull requests 
Type ? for help and tips 
Tip: Type is:issue to filter to issues 
Type ? for help and tips 
Tip: Type is:project to filter to projects 
Type ? for help and tips 
Tip: Type is:open to filter to open content 
Type ? for help and tips 

We’ve encountered an error and some results aren't available at this time. Type a new search or try again later. 
No results matched your search Search for issues and pull requests # Search for issues, pull requests, discussions, and projects # Search for organizations, repositories, and users @ Search for projects ! Search for files / Activate command mode > Search your issues, pull requests, and discussions # author:@me Search your issues, pull requests, and discussions # author:@me Filter to pull requests # is:pr Filter to issues # is:issue Filter to discussions # is:discussion Filter to projects # is:project Filter to open issues, pull requests, and discussions # is:open 

Jeffrey218 / OpenWrt-CI Public 
forked from KFERMercer/OpenWrt-CI 
	•	Pin   
	•	Watch 0  Notifications  Participating and @mentions  Only receive notifications from this repository when participating or @mentioned.   All Activity  Notified of all notifications on this repository.   Ignore  Never be notified.    Custom   Select events you want to be notified of in addition to participating and @mentions.   Get push notifications on iOS or Android.      
	•	Fork 6.1k       
	•	Starred 0        Star 0         

	•	Code 
	•	Pull requests 
	•	Actions 
	•	Projects 
	•	Wiki 
	•	Security 
	•	Insights 
	•	Settings 
More 
	•	
Open in github.dev Open in a new github.dev tab
Permalink
master 
Switch branches/tags 

Branches Tags 

View all branches
Name already in use

A tag already exists with the provided branch name. Many Git commands accept both tag and branch names, so creating this branch may cause unexpected behavior. Are you sure you want to create this branch? 
Cancel Create 
OpenWrt-CI/openwrt-ci.yml 
Go to file

	•	Go to file T 
	•	Go to line L 
	•	
	•	Copy path 
	•	Copy permalink 

 
 
Cannot retrieve contributors at this time 
140 lines (115 sloc) 4.35 KB 
Raw Blame 


Edit this file
E
Open in github.dev
.
Open in GitHub Desktop 



	•	Open with Desktop 
	•	View raw 
	•	Copy raw contents 
	•	View blame 
	•	
	•	Edit file 
	•	Open with github.dev 
	•	Delete file 

#

# This is free software, lisence use MIT.

# 

# Copyright (C) 2019 P3TERX <https://p3terx.com>

# Copyright (C) 2020 KFERMercer <KFER.Mercer@gmail.com>

# 

# <https://github.com/KFERMercer/OpenWrt-CI>

#



name: OpenWrt-CI



on:

push:

branches: 

- master

# schedule:

# - cron: 0 20 * * *

release:

types: [published]



jobs:



build_openwrt:



name: Build OpenWrt firmware



runs-on: ubuntu-latest



if: github.event.repository.owner.id == github.event.sender.id



steps:



- name: Checkout

uses: actions/checkout@v2

with:

ref: master



- name: Space cleanup

env:

DEBIAN_FRONTEND: noninteractive

run: |

docker rmi `docker images -q`

sudo rm -rf /usr/share/dotnet /etc/mysql /etc/php /etc/apt/sources.list.d

sudo -E apt-get -y purge azure-cli ghc* zulu* hhvm llvm* firefox google* dotnet* powershell openjdk* mysql* php* android*

sudo -E apt-get update

sudo -E apt-get -y install build-essential asciidoc binutils bzip2 gawk gettext git libncurses5-dev libz-dev patch python3 unzip zlib1g-dev lib32gcc1 libc6-dev-i386 subversion flex uglifyjs gcc-multilib g++-multilib p7zip p7zip-full msmtp libssl-dev texinfo libglib2.0-dev xmlto qemu-utils upx libelf-dev autoconf automake libtool autopoint device-tree-compiler antlr3 gperf swig libtinfo5

sudo -E apt-get -y autoremove --purge

sudo -E apt-get clean



# sudo mkdir -p -m 777 /mnt/openwrt/bin /mnt/openwrt/build_dir/host /mnt/openwrt/build_dir/hostpkg /mnt/openwrt/dl /mnt/openwrt/feeds /mnt/openwrt/staging_dir

# ln -s /mnt/openwrt/bin ./bin

# mkdir -p ./build_dir

# ln -s -f /mnt/openwrt/build_dir/host ./build_dir/host

# ln -s -f /mnt/openwrt/build_dir/hostpkg ./build_dir/hostpkg

# ln -s /mnt/openwrt/dl ./dl

# ln -s /mnt/openwrt/feeds ./feeds

# ln -s /mnt/openwrt/staging_dir ./staging_dir



df -h



- name: Update feeds

run: |

./scripts/feeds update -a

./scripts/feeds install -a



- name: Generate configuration file

run: |

rm -f ./.config*

touch ./.config



#

# 在 cat >> .config <<EOF 到 EOF 之间粘贴你的编译配置, 需注意缩进关系

# 例如:



cat >> .config <<EOF

CONFIG_TARGET_IMAGES_GZIP=y

CONFIG_KERNEL_BUILD_USER="OpenWrt-CI"

CONFIG_KERNEL_BUILD_DOMAIN="Azure"

EOF



#

# ===============================================================

# 



sed -i 's/^[ \t]*//g' ./.config

make defconfig



- name: Make download

run: |

make download -j8 || make download -j1 V=s

rm -rf $(find ./dl/ -size -1024c)

df -h



- name: Compile firmware

run: |

make -j$(nproc) || make -j1 V=s

echo "======================="

echo "Space usage:"

echo "======================="

df -h

echo "======================="

du -h ./ --max-depth=1

du -h /mnt/openwrt/ --max-depth=1 || true



- name: Prepare artifact

run: |

mkdir -p ./artifact/firmware

mkdir -p ./artifact/package

mkdir -p ./artifact/buildinfo

rm -rf $(find ./bin/targets/ -type d -name "packages")

cp -rf $(find ./bin/targets/ -type f) ./artifact/firmware/

cp -rf $(find ./bin/packages/ -type f -name "*.ipk") ./artifact/package/

cp -rf $(find ./bin/targets/ -type f -name "*.buildinfo" -o -name "*.manifest") ./artifact/buildinfo/



- name: Deliver buildinfo

uses: actions/upload-artifact@v2

with:

name: OpenWrt_buildinfo

path: ./artifact/buildinfo/



- name: Deliver package

uses: actions/upload-artifact@v2

with:

name: OpenWrt_package

path: ./artifact/package/



- name: Deliver firmware

uses: actions/upload-artifact@v2

with:

name: OpenWrt_firmware

path: ./bin/targets/



- name: Upload release asset

if: github.event == 'release'

uses: svenstaro/upload-release-action@v2

with:

repo_token: ${{ secrets.YOURTOKEN }}

file: ./artifact/firmware/*

tag: ${{ github.ref }}

file_glob: true

	•	Copy lines 
	•	Copy permalink 
	•	View git blame

Go 
Footer
© 2022 GitHub, Inc. 
Footer navigation
	•	Terms
	•	Privacy
	•	Security
	•	Status
	•	Docs
	•	Contact GitHub
	•	Pricing
	•	API
	•	Training
	•	Blog
	•	About

